---
title: 文件整理
description: 媒体库目录和文件整理方式
published: true
date: 2024-06-18T06:05:17.937Z
tags: 
editor: markdown
dateCreated: 2024-06-18T06:05:17.937Z
---

# 媒体库目录

在 `设定 → 目录 → 媒体库目录` 中添加目录配置：

- 如果你是使用 docker 环境部署，媒体库目录对应的根目录需要映射到容器中，否则文件整理后会存储到容器内导致容器异常。
- 如果你使用 `硬链接` 整理方式，则媒体库目录和下载目录需要在 **同一磁盘/存储空间/映射路径**，否则无法硬链接。

更多参见 [进阶](/advanced) 多目录支持与分类章节。

# 自动整理

MoviePilot 通过**监测下载器中的下载任务状态**来实现自动整理已下载的文件，通过 `设定 → 连接 → 下载器` 打开 `下载文件自动整理` 开关开启自动整理功能。

- **自动整理定时检查时间隔间为 `5分钟`**。如果使用 `Qbittorrent` 做为下载器，可在 QB设置 → 下载完成时运行外部程序 处填入：curl "http://localhost:3000/api/v1/transfer/now?token=moviepilot" ，实现无需等待轮循下载完成后立即整理入库（地址、端口和 token 按实际调整，curl 也可更换为 wget）。
- 如启用了多个下载器，**默认只会监控整理第 1 个下载器的下载任务**。
- 如果设定了 `下载器种子标签`，则只有下载器中有对应标签的下载任务才会被自动整理。

### 目录监控

对于非 MoviePilot 添加的下载任务，插件市场中提供了 `目录监控` 等插件实现自动监测和整理，这类插件通过监测文件变化来实现自动整理，**注意参照 [环境准备](/ready) 中操作系统章节说明调整文件系统参数，同时需要打开下载器的 `为不完整文件添加扩展名` 选项，以避免文件在下载中就被自动转移了。**

> 建议通过 MoviePilot 下载的内容优先使用内建的**下载文件自动整理**实现自动整理，基于监控目录整理等仅是插件提供的功能，非推荐整理方式。
{.is-warning}

# 文件整理方式

根据磁盘结构、空间大小、保种需要等综合决定使用哪种文件整理方式，在 `设定 → 目录 → 整理模式` 中调整。

- **硬链接**：一份文件生成多个文件入口，但只占用一份存储空间，只有所有入口都删除后才能释放文件占用空间；可以修改硬链接后的文件名但不会影响原文件做种（不能修改文件内容）；**要求在同一磁盘/存储空间/映射路径下才能硬链接。**
- **软链接**：类似于快捷方式，原文件删除后软链接即会失效；使用软链接时的原文件路径需要与生成软链接时的原文件路径保持一致，否则无法使用，也就是在 docker 环境下，映射前后的目录路径需要一致。
- **复制**：复制一份副本，多占用一份空间。
- **移动**：移动文件存储位置，会影响原文件做种。
- **Rclone 复制**：使用 Rclone 复制本地文件到网盘，需要自行映射 rclone 配置目录到容器中（`/nt/.config/rclone`）或在容器内使用 `rclone config` 完成 rclone 配置，网盘配置名称必须为：`MP`，可自行通过 Docker 添加环境变量传递参数优化传输，参考：https://rclone.org/docs/#environment-variables 。
- **Rclone 移动**：使用 Rclone 移动本地文件到网盘，其余与 Rclone 复制一致。


# 文件覆盖方式

在 `设定 → 目录 → 整理模式` 中调整媒体库已存在同名文件（后缀名也相同）时对应的处理策略：

- `从不覆盖`：当媒体库中存在同名文件时中断整理，历史记录中将产生错误的整理记录。
- `按大小覆盖`：当下载文件比媒体库中已有文件更大时覆盖已有文件，否则中断整理并在历史记录中将产生错误的整理记录。
- `总是覆盖`：直接使用下载的文件覆盖媒体库中的同名文件。
- `仅保留最新版本`：同一个电影或者电视剧剧集，**删除媒体库中的其它版本文件（包括文件名不一致的）**，仅保留下载整理的最新版本。

# 手动整理文件

- 文件自动整理失败时，将会产生失败记录，可在 `历史记录` 中手动进行整理。
- 通过 `文件管理` 功能浏览文件系统，对整个目录或者某个文件进行手动整理。

如涉及需要同时整理多个相似文件（比如一部剧有多集），参见 [进阶](/advanced) 批量手动整理章节。